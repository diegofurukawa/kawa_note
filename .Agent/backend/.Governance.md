# GOVERNANCE — BACKEND

## Classificação
- **Tipo:** Backend
- **Runtime:** Node.js 20 LTS
- **Framework:** Fastify 4
- **Database:** PostgreSQL 16 + Prisma 5
- **Escopo:** API REST, autenticação, persistência de dados

## Relação com Governança Global
Este arquivo **estende e especializa** `/.Agent/.AgentRules.md`, `/.Agent/.CodeConventions.md` e `/.Agent/.CodeReview.md`.

**Nenhuma regra aqui contradiz a governança global.**

## Papéis Permitidos
- **AGENT_AUDITOR:** Auditoria de código, arquitetura, segurança, performance.
- **AGENT_EXECUTOR:** Execução de planos aprovados no escopo `backend/`.

## Escopo Permitido
- ✅ Modificar código em `backend/src/`
- ✅ Modificar configurações em `backend/src/config/`
- ✅ Modificar schemas Prisma em `backend/prisma/`
- ✅ Modificar migrations em `backend/prisma/migrations/`
- ✅ Modificar `backend/package.json` (dependências)
- ❌ Modificar código em `src/` (frontend)
- ❌ Modificar governança global em `/.Agent/`
- ❌ Modificar regras ou convenções globais

## Critérios de HALT (Bloqueio Imediato)
1. **Segurança:** Exposição de chaves, senhas ou dados sensíveis.
2. **Integridade:** Alteração de migrations já executadas.
3. **Compatibilidade:** Quebra de contrato de API sem versionamento.
4. **Lint:** Código que não passa em `npm run lint` (backend).
5. **Tipo:** Erros de tipagem ou validação Zod.
6. **Teste:** Falha em testes unitários ou de integração.

## Níveis de Permissão
- **Nível 0:** Observador (default)
- **Nível 1:** Planejador (criar planos)
- **Nível 2:** Executor Limitado (executar planos simples)
- **Nível 3:** Executor Total (executar planos complexos)
- **Nível 4:** Governança (modificar este arquivo)

## Processo de Trabalho
1. **Auditoria:** Verificar código, arquitetura, segurança.
2. **Planejamento:** Criar plano em `/.Agent/.plans/PLAN-<date>-<app>.md`.
3. **Aprovação:** Aguardar confirmação explícita do usuário.
4. **Execução:** Executar plano, gerar relatório em `/.Agent/.plans/reports/`.

## Restrições Adicionais
- Não modificar `backend/.env` (variáveis sensíveis).
- Não modificar `backend/Dockerfile` sem aprovação explícita.
- Não modificar `backend/docker-compose.yml` sem aprovação explícita.
- Migrations devem ser criadas via Prisma CLI, nunca manualmente.

## Sincronização de Documentação
A cada execução, verificar:
- `backend/package.json` vs `/.Agent/backend/.Stack.md`
- `backend/src/` vs `/.Agent/backend/.Architecture.md`
- Atualizar se houver divergência.

## Status Atual
- ✅ Governança criada
- ⏳ Aguardando auditoria inicial
- ⏳ Aguardando planos de execução
